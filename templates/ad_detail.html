<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ ad.title }} - AgroTracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/comments-ratings.css') }}">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">üåæ AgroTracker</a>
                <nav class="nav-links">
                    <a href="/ads/ads">–í—Å—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</a>
                    <a href="/map">–ö–∞—Ä—Ç–∞ —Ä–µ–≥—ñ–æ–Ω—ñ–≤</a>
                    <a href="/user/profile">–ü—Ä–æ—Ñ—ñ–ª—å</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Ad Details -->
            <div class="card">
                <h1 class="ad-title">{{ ad.title }}</h1>
                <div class="ad-price">{{ ad.price }} UAH</div>
                <div class="ad-location">üìç {{ ad.location }}</div>
                <div class="ad-description">{{ ad.description }}</div>
                
                {% if ad.images %}
                <div class="ad-images">
                    {% for image in ad.images %}
                    <img src="{{ image.image_url }}" alt="–§–æ—Ç–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è" class="ad-image">
                    {% endfor %}
                </div>
                {% endif %}
                
                <div class="ad-meta">
                    <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ seller_email }}</p>
                    <p><strong>–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:</strong> {{ ad.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                </div>
            </div>

            <!-- Seller Rating Section -->
            <div class="rating-section">
                <div class="rating-header">
                    <h2 class="rating-title">–†–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ–¥–∞–≤—Ü—è</h2>
                </div>
                
                <div id="rating-summary"></div>
                
                <!-- Rate Seller Form -->
                <div class="rating-form">
                    <h3>–û—Ü—ñ–Ω—ñ—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—è</h3>
                    <div class="rating-input-group">
                        <label class="rating-label">–í–∞—à–∞ –æ—Ü—ñ–Ω–∫–∞:</label>
                        <div class="rating-stars-input" data-selected-rating="0">
                            <span class="star" data-rating="1">‚òÜ</span>
                            <span class="star" data-rating="2">‚òÜ</span>
                            <span class="star" data-rating="3">‚òÜ</span>
                            <span class="star" data-rating="4">‚òÜ</span>
                            <span class="star" data-rating="5">‚òÜ</span>
                        </div>
                    </div>
                    <div class="rating-input-group">
                        <label class="rating-label" for="rating-comment">–ö–æ–º–µ–Ω—Ç–∞—Ä (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                        <textarea id="rating-comment" class="rating-comment-textarea" 
                                  placeholder="–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º –¥–æ—Å–≤—ñ–¥–æ–º —Å–ø—ñ–≤–ø—Ä–∞—Ü—ñ –∑ —Ü–∏–º –ø—Ä–æ–¥–∞–≤—Ü–µ–º..."></textarea>
                    </div>
                    <div class="rating-form-actions">
                        <button class="submit-rating-btn" data-ad-id="{{ ad.id }}">–û—Ü—ñ–Ω–∏—Ç–∏</button>
                    </div>
                </div>

                <!-- Ratings List -->
                <div id="ratings-list"></div>
                <div id="ratings-pagination"></div>
            </div>

            <!-- Comments Section -->
            <div class="comments-section" id="comments-section">
                <div class="comments-header">
                    <h2 class="comments-title">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>
                    <button class="add-comment-btn" data-ad-id="{{ ad.id }}">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
                </div>
                
                <div id="comments-list"></div>
                <div id="comments-pagination"></div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/comments-ratings.js') }}"></script>
    <script>
        // Initialize with current ad and user data
        document.addEventListener('DOMContentLoaded', function() {
            commentsRatingsManager.setCurrentAdId({{ ad.id }});
            
            // Set auth token if user is logged in
            const authToken = localStorage.getItem('authToken');
            if (authToken) {
                commentsRatingsManager.setAuthToken(authToken);
            }
            
            // Load initial data
            commentsRatingsManager.loadComments({{ ad.id }});
            commentsRatingsManager.loadUserRatings('{{ ad.user_id }}');
        });
    </script>
</body>
</html>